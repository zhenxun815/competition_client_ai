<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">
	<meta content="ie=edge" http-equiv="X-UA-Compatible">
	<!-- ztree 样式 -->
	<link href="../library/ztree/css/zTreeStyle/zTreeStyle.css" rel="stylesheet">
	<!-- layui 样式 -->
	<link href="../library/layui/2.5.4/css/layui.css" rel="stylesheet">
	<!-- bs 样式 -->
	<!-- 暂时不需要 -->
	<link href="../library/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<!-- iview 样式 -->
	<!-- 暂时不需要 -->
	<link href="../library/iview@3.2.2/dist/styles/iview.css" rel="stylesheet">
	<!-- 公共样式 -->
	<link href="../css/common.css" rel="stylesheet">
	<!-- 全部样式 -->
	<link href="../css/all.css" rel="stylesheet">
	<!-- 响应式支持 -->
	<script src="../js/rem.js" type="text/javascript"></script>
	<!-- 滚轮兼容 -->
	<script src="../js/scroll.js" type="text/javascript"></script>
	<!-- 引入 jscolor -->
	<!-- 改变标注颜色会用到 -->
	<script src="../library/jscolor/jscolor.js" type="text/javascript"></script>

	<title>AIC</title>


</head>

<body oncontextmenu="return false" style="background: #f5f5f5">

<!-- 遮罩 START -->
<div class="full-mask" id="full_mask" style="display: none">
	<div class="fm-word">正在加载...</div>
</div>
<!-- 遮罩 JS START -->
<script>
	document.getElementById('full_mask').style.display = 'block'
</script>

<!-- 标注页面 START -->
<div class="mark-core-page clearfix">
	<!-- 需要凭着这个ID查询这个元素的宽度 -->
	<!-- 这个class不能改，且不能重复 -->
	<!-- id mark_tree -->
	<div class="mark-core-tree-zone" id="mark_tree" style="">
		<div class="layui-tab" lay-filter="layui_tab_left">
			<ul class="layui-tab-title">
				<li class="layui-this">标注分类</li>
				<!--<li>测试详情</li>-->
				<li>标注颜色</li>
			</ul>
			<div class="layui-tab-content">
				<div class="layui-tab-item layui-show tree-box">
					<div class="search-zone">
						<form action="">
							<div class="input-zone">

								<input class="m-input roundrect-input" id="key" placeholder="搜索关键词" type="text">
								<button class="m-icon search" style="position: absolute" type="button"></button>

							</div>
						</form>
					</div>
					<div class="tree-zone">
						<ul class="ztree" id="treeDemo0"></ul>
					</div>
					<!-- 悬浮白色区域 -->
					<div class="showy" id="showy" style="display:none">已标注 ..</div>
				</div>
				<!--<div class="layui-tab-item detail-box">
					<p class="p">测试任务名称</p>
					<p class="p"><span class="gray">被测试模型：</span></p>
					<p class="p"><span class="gray">迭代次数：</span></p>
					<p class="p"><span class="gray">测试类型：</span></p>
					<p class="p t-classify"><span class="gray">测试数据：</span><span class="w"></span><span
							class="m-icon infomation" id="infomation"></span></p>
					<p class="p"><span class="gray" style="display: inline-block;vertical-align: top">备注信息：</span>
						<span class="square">

                &lt;!&ndash; <span class="abs m-icon blue-tri"></span> &ndash;&gt;
              </span>
					</p>
					<p class="p"><span class="gray">测试结果：</span></p>
				</div>-->
				<div class="layui-tab-item color-box">
					当前标注颜色：
					<input class="jscolor m-input roundrect-input" id="my_color" style="width: auto;border:0" value=""/>
				</div>
			</div>
		</div>

		<!-- 树 标注用 -->
		<!-- <div class="tree-box" style="display: none">

		  <div class="search-zone">
			<form action="">
			  <div class="input-zone">

				<input id="key" type="text" class="m-input roundrect-input" placeholder="搜索关键词">
				<button class="m-icon search" type="button" style="position: absolute"></span>

			  </div>
			</form>
		  </div>
		  <div class="tree-zone">
			<ul id="treeDemo0" class="ztree"></ul>
		  </div>

		  <div class="showy" id="showy">已标注 ..</div>
		</div>

		</div> -->
	</div>

	<div class="mark-core-core-zone" id="mark">
		<!-- BLACK ZONE -->
		<div class="mark-core-mark-zone">
			<div class="black-zone-image-box">
				<div id="svg_my_father"
				     style="width:512px;height:512px;/*background-image: url('');*/background-size:100%;background-repeat:no-repeat;position:relative">
					<!-- <svg id="svg_my"
					style="width:512px;height:512px;background-image: url('');background-size:100%;background-repeat:no-repeat"
					version="1.1"
					xmlns="http://www.w3.org/2000/svg">
					</svg> -->
					<svg id="svg_my" style="width:100%;height:100%;position:relative;z-index:99;outline:none"
					     version="1.1" xmlns="http://www.w3.org/2000/svg">
					</svg>
					<!-- <img id="svg_img"
					style="width:100%;height:100%;position:absolute;z-index:98;left:0;top:0"
					src="" alt=""> -->
				</div>
			</div>
		</div>
		<!-- BLACK ZONE END -->
		<!-- 这个class不能改，且不能重复 -->
		<div class="mark-core-data-zone">
			<div class="dmvda-r">
				<!-- 圆形菜单 -->
				<div class="abs mark-core-circle-button-box">
					<!-- <a href="./data_mark_core.html"> -->
					<!-- 分配任务 查看数据用 -->
					<div class="com-circle-button button distribution" id="tips_distribution"
					     style="margin:0 20px 0 0;display: none"></div>
					<!-- 删除 查看数据用 -->
					<div class="com-circle-button button delete" id="tips_delete" style="display: none"></div>
					<!-- 返回 标注用 测试结果用 -->
					<div class="com-circle-button button back" id="tips_back" style="display: none" style=""></div>
					<!-- </a> -->
				</div>
				<!-- 手动输入跳转 -->
				<!--<div class="manual-operation">
					&lt;!&ndash; <form action="" class="form-inline"> &ndash;&gt;
					转至第<input class="m-input open-input" id="choose_manual_value" type="text">张&nbsp;&nbsp;
					&lt;!&ndash; bs 下拉菜单 废弃 &ndash;&gt;
					&lt;!&ndash; bs 下拉菜单 END &ndash;&gt;
					<button class="m-btn mark-jump size mini" id="choose_manual_button"
					        type="button">确定
					</button>
					&lt;!&ndash; </form> &ndash;&gt;
				</div>-->
				<!-- 样本地址 -->
				<div class="number-msg-zone">
					<p class="specimen-address"><span id="specimen_address_name"></span></p>
					<p class="specimen-address">
						<span id="specimen_address_case"></span>&nbsp;<span id="specimen_address_index"></span></p>
					<!-- 已标注（X/X例） -->
					<!--<p class="specimen-address" id="mark_had_complete"><span>已标注</span>&emsp;<span
							id='msgSpan'></span><span id='imageMarkSpan'></span></p>-->
				</div>
				<!-- 标题 -->
				<!-- <div class="dmvda-r-t">新疆肺结核CT2019190511</div> -->
				<!-- 绘制标注 标注用-->
				<!-- 需要标注按钮控制的矩形 多边形按钮 -->
				<div class="mark-button-margin" style="padding-top:0px;">

					<div class="my-mark-button os mark-enter" id="mark_mark">
						<span class="icon tag mark-enter"></span>
						<span class="mark-enter">绘制标注</span>


						<div class="data-menu-zone select-figure-button one-floor">
							<div class="item-typeb">
								<div class="my-mark-button" id="mark_polygon">
									<span class="icon polygon"></span>
									<span>多边形</span>
								</div>
							</div>
							<div class="item-typeb">
								<div class="my-mark-button" id="mark_rect">
									<span class="icon rect"></span>
									<span>矩形</span>
								</div>
							</div>
						</div>
					</div>

				</div>

				<!-- 序列完成 标注用-->
				<!-- <div class="mark-button-margin" style="">
				  <div class="my-mark-button os">
					<span class="icon complete"></span>
					<span>序列完成</span>
				  </div>
				</div> -->

				<!-- 显示设置按钮 测试结果用-->
				<div class="mark-button-margin" style="display: none">
					<div class="data-menu-zone one-floor">
						<div class="item-typeb">
							<div class="my-mark-button" id="t_r_btn_a">
								<span class="icon zoom"></span>
								<span>缩放图片</span>
							</div>
						</div>
						<div class="item-typeb">
							<div class="my-mark-button" id="t_r_btn_b">
								<span class="icon save"></span>
								<span>保存图片</span>
							</div>
						</div>
					</div>
				</div>
				<!-- <input type="text" class="jscolor"> -->
				<!-- 更改标注颜色 -->
				<!-- id="t_r_btn_c" -->

				<!-- 清除单张 清除所有 -->
				<div class="mark-button-margin" style="">
					<div class="data-menu-zone one-floor">
						<div class="item-typeb">
							<div class="my-mark-button" id="t_r_btn_e">
								<span class="icon delete"></span>
								<span>清除单张</span>
							</div>
						</div>
						<div class="item-typeb">
							<div class="my-mark-button" id="t_r_btn_f">
								<span class="icon delete"></span>
								<span>清除所有</span>
							</div>
						</div>
					</div>
				</div>


				<!-- jscolor -->
				<!-- <input id="my_color" style="opacity: 0;height:0;border:0;font-size:0;line-height:0;position:absolute" class="jscolor" value="" /> -->

				<script>

				</script>

				<!-- 同步到标注 -->
				<div class="mark-button-margin" style="">
					<div class="data-menu-zone one-floor">
						<div class="item-typeb">
							<div class="my-mark-button" id="save_synchronization">
								<!-- <span class="icon palette"></span> -->
								<span>完成本题</span>
							</div>
						</div>
					</div>
				</div>

				<!-- 四维导航 -->
				<div class="data-menu-zone">
					<!--<div class="item">
						<div class="my-mark-button x2 jump_button" id="jump_button_a">
							<span class="icon left"></span>
							<span>前一例</span>
						</div>
					</div>-->
					<div class="item">
						<div class="my-mark-button" onclick="toJumpImageFunc('up')">
							<span class="icon up"></span>
							<span>上一张</span>
						</div>
						<div class="my-mark-button" onclick="toJumpImageFunc('down')">
							<span class="icon down"></span>
							<span>下一张</span>
						</div>
					</div>
					<!--<div class="item">
						<div class="my-mark-button x2 jump_button" id="jump_button_b">
							<span class="icon right"></span>
							<span>后一例</span>
						</div>
					</div>-->
				</div>

				<!-- 文件列表 标注用-->
				<!-- <div class="file-list-zone" style="">
				  <h6 class="flz-title">文件列表</h6>
				  <div class="flz-core">
				  </div>
				</div> -->

				<!-- 右下角tab区 -->
				<div class="right-bottom-zone">
					<div class="layui-tab" lay-filter="layui_tab_right">
						<ul class="layui-tab-title">
							<li class="layui-this">序列</li>
							<li class="">标注分类</li>
							<!--<li class="">模型分类</li>
							<li class="">阈值</li>
							<li class="">课题</li>
							<li class="">模型</li>-->
						</ul>
						<div class="layui-tab-content">
							<!-- 序列 -->
							<div class="layui-tab-item layui-show file-list-zone">
								<div class="flz-core">
								</div>
							</div>
							<!-- 阈值 -->
							<!--<div class="layui-tab-item slider-zone">

								<div class="demo-slider" id="demo_slider"></div>
								<b class="left w abs">低</b>
								<b class="right w abs">高</b>

							</div>-->
							<!-- 标签分类 -->
							<div class="layui-tab-item choose-type-zone">
								<p class="sli-title"></p>
								<div class="layui-form abs" style="top:0;right:0">
									<div class="layui-form-item">
										<input checked="true" class="c_all" class="cityAll" data-title="c_all"
										       id="c_all" lay-filter="c_all" lay-skin="primary" title="全部"
										       type="checkbox">
									</div>
								</div>
								<div class="layui-form" id="types">
									<!-- <input type="checkbox" name="rrrrr" data-id="rrrrr" class="cityId" lay-filter="c_other" lay-skin="primary" title="甲甲甲甲" checked="true">
									<input type="checkbox" name="sssss" data-id="sssss" class="cityId" lay-filter="c_other" lay-skin="primary" title="乙乙乙乙" checked="true">
									<input type="checkbox" name="ttttt" data-id="ttttt" class="cityId" lay-filter="c_other" lay-skin="primary" title="丙丙丙丙" checked="true">
									<input type="checkbox" name="uuuuu" data-id="uuuuu" class="cityId" lay-filter="c_other" lay-skin="primary" title="丁丁丁丁" checked="true">
									<input type="checkbox" name="41ce00f68aa8469db1f87a933a326623" data-id="41ce00f68aa8469db1f87a933a326623" class="cityId" lay-filter="c_other" lay-skin="primary" title="肺结节" checked="true"> -->
								</div>
							</div>
							<!-- 模型分类 -->
							<!--<div class="layui-tab-item choose-model-zone">
								<p class="sli-title"></p>
								<div class="layui-form abs" style="top:0;right:0">
									<div class="layui-form-item">
										<input checked="true" class="m_all" class="modelAll" data-title="m_all"
										       id="m_all" lay-filter="m_all" lay-skin="primary" title="全部"
										       type="checkbox">
									</div>
								</div>
								<div class="layui-form" id="cb_models">
									&lt;!&ndash; <input type="checkbox" name="model_a" data-id="model_a" class="modelId" lay-filter="m_other" lay-skin="primary" title="A" checked="true"> &ndash;&gt;
									&lt;!&ndash; <input type="checkbox" name="model_b" data-id="model_b" class="modelId" lay-filter="m_other" lay-skin="primary" title="B" checked="true"> &ndash;&gt;
									&lt;!&ndash; <input type="checkbox" name="model_c" data-id="model_c" class="modelId" lay-filter="m_other" lay-skin="primary" title="C" checked="true"> &ndash;&gt;
								</div>
								&lt;!&ndash; 识别按钮 &ndash;&gt;
								<span class="m-btn abs" id="discriminate" style="right: 0; bottom:20px">识别</span>
							</div>-->
							<!-- 课题 -->
							<!--<div class="layui-tab-item">
								<p class="sli-title"></p>
								<div class="layui-form" id="topic_radio">
									&lt;!&ndash; <input type="radio" name="topic" value="男" title="男" checked="false"> &ndash;&gt;
								</div>
							</div>-->
							<!-- 模型 -->
							<!--<div class="layui-tab-item"></div>-->
						</div>
					</div>
				</div>

			</div>
		</div>
	</div>
	<!-- mjs:tip -->
	<!-- 悬浮提示 -->
	<div class="tip" id="mjs:tip" style="position:absolute;left:0;top:0;display:none;"></div>
	<!-- jqContextMenu 删除用菜单 -->
	<div id="jqContextMenu" style="display:none;">
		<ul style="list-style:none">
			<!-- <li id="delete" onclick='deletePolygon()'> -->
			<li id="delete" style="">
				<img src="../img/cross.png" style=""/>删除
			</li>
			<li id="change_type" style="">
				变更到当前分类
			</li>
		</ul>
	</div>
</div>
<!-- 标注页面 END -->


<!-- 引入 layui -->
<script src="../library/layui/2.5.4/layui.js" type="text/javascript"></script>
<!-- 引入 jquery -->
<script src="../library/jquery/1.12.4/jquery.min.js" type="text/javascript"></script>
<!-- 引入 bs js -->
<!-- 暂时不需要 -->
<script src="../library/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<!-- 引入 ztree js -->
<script src="../library/ztree/js/jquery.ztree.core.js" type="text/javascript"></script>
<script src="../library/ztree/js/jquery.ztree.excheck.js" type="text/javascript"></script>
<script src="../library/ztree/js/jquery.ztree.exedit.js" type="text/javascript"></script>
<script src="../library/ztree/js/jquery.ztree.exhide.js" type="text/javascript"></script>
<!-- ztree 搜索功能会用到 -->
<script src="../library/ztree/js/fuzzysearch.js" type="text/javascript"></script>
<!-- 引入 smartzoom -->
<!-- 这个js文件是改过的（修复一个BUG）与原版不一样 -->
<!-- 在 290 行 -->
<script src="../library/smartzoom/e-smart-zoom-jquery.min.js" type="text/javascript"></script>

<!-- ztree 自定义js -->
<script src="../js/tag_tree_polyfill.js" type="text/javascript"></script>
<!-- 注意 此文件不要替换线上版本 -->
<!-- 如果你想统一的话，可以自行优化...（改之前请示领导） -->
<script src="../js/tag_tree.js" type="text/javascript"></script>
<!-- 实例化 ztree 并绑定业务所需的方法 -->
<script src="../js/tag_tree2.js" type="text/javascript"></script>

<!-- 引入 自定义的 tag.js 三个标注都会用到的公共方法 -->
<script src="../js/tag.js" type="text/javascript"></script>
<!-- tag2.js tag.js的补充 以前直接写在页面里的js -->
<script src="../js/tag2.js" type="text/javascript"></script>
<!-- tag2.js的补充 主要是附加功能 -->
<script src="../js/tag_tag.js" type="text/javascript"></script>

<script>
	// 标注配置项
	// 不在里面的就是暂时不可配置的
	var TagConfig = {
		url_dicomImagePath: 0, // 图片 base 路径
		left_margin: 0, // 页面区距离屏幕左侧的距离
		leftX: null, // 标注区距离左侧的距离 | 会根据 left_margin markTreeId 计算 所以是 null
		topY: 0, // 标注区距离上部的距离
		jqContextMenuOffsetLeftNumber: 20, // 右键菜单距离鼠标的水平距离
		// 可以标注什么形状
		// 必须是一个 Array
		// 支持 polygon rect
		// 写在前面的是默认值
		graphArray: ['rect'],
		// 悬浮提示的样式
		TipFont: {
			fontSize: '14px',
			lineHeight: '16px',
			fontWeight: '400'
		},
		// 颜色
		Colors: {
			baseColor: "#FF0000", // 标注框的颜色（可以在界面中修改）
			wordColor: "#FF0000", // 悬浮提示文字的颜色
		},
		// SVG图形样式
		SVGGraphSize: {
			// 线点偏差值 | 需要线和点有一定距离防止点不到起始点
			pointOffOffset: 3,
			// 点的大小 | 数组length 1-3 | 单数字也可以
			pointSizeArray: [1.5, 3, 6]
		},
		// 需要挂载渲染的ID
		RenderDomId: {
			markTreeId: "mark_tree", // 分类树DOM 用的ID
			svg_father_id: "svg_my_father",
			svgId: "svg_my"
		},
		// ztree setting
		ztreeSetting: {
			view: {
				expandSpeed: "",
				//addHoverDom: addHoverDom,
				// removeHoverDom: removeHoverDom,
				selectedMulti: false,
				nameIsHTML: true, //允许name支持html
				showIcon: false,
				showLine: false,
				//addDiyDom: function (treeId, treeNode) {
				// console.log(treeNode)
				// var aObj = $("#" + treeNode.tId + "_a");
				//var editStr = "<i class='origin_id' data-originid='" + treeNode.id + "' style='display:none'></i>"
				//$("#" + treeNode.tId + "_span").before(editStr);
				// }
			},
			edit: {
				enable: false,
				editNameSelectAll: false
			},
			data: {
				simpleData: {
					enable: true
				}
			},
			callback: {
				//beforeRemove: beforeRemove,
				//beforeRename: beforeRename,
				onClick: zTreeOnClickFunc
			}
		}
	}

	// console.log("TIMESTAMP === TagInitFunc ", new Date().getTime())
	var caseArr = []
	var userName = ''
	var serverIP = ''
	var currCaseIndex = 0
	var currCaseName = ''
	// 配置注入入口
	TagInitFunc(TagConfig)

	$(document).ready(function () {
		// console.log("TIMESTAMP === RenderFunc ", new Date().getTime())

		// 渲染入口
		// 变更样本时需要重新渲染
		getOriginA()


		$("#save_synchronization").click(function () {
			console.log('save_synchronization....')
			currCaseIndex += 1
			console.log(`$total case num ${caseArr.length}, currCaseIndex is ${currCaseIndex}`)
			if (currCaseIndex >= caseArr.length) {
				tips_message_func('已经完成最后一题..')
				currCaseIndex--
				noteStop()
			} else {
				console.log(`currCaseName is ${currCaseName}`)
				currCaseName = caseArr[currCaseIndex].caseName
				networkImagePageData.caseId = caseArr[currCaseIndex].id
				calcSynchronizationFunc()
				saveSubmitAllFunc()
				console.log(`networkImagePageData.caseId is ${networkImagePageData.caseId}`)
				RenderFunc(caseArr[currCaseIndex].originDatas)
			}
		})
	})

	function getOriginA() {
		$.ajax({
			type: "GET",
			url: '/originA',
			async: true,
			success: function (response) {
				if (response) {
					console.log('response is: ' + JSON.stringify(response))
					//let res = JSON.parse(response)
					caseArr = JSON.parse(response.caseJson)
					userName = response.userName
					serverIP = response.serverIP
					console.log('case arr: ' + caseArr)
					console.log('user name: ' + userName)
					console.log('serverIP: ' + serverIP)
					currCaseIndex = 0
					networkImagePageData.caseId = caseArr[currCaseIndex].id
					currCaseName = caseArr[currCaseIndex].caseName
					console.log('case Id: ' + networkImagePageData.caseId)
					RenderFunc(caseArr[0].originDatas)
					noteStart()
				}
			}
		})
	}


	function noteStart() {
		let datas = {code: userName}
		$.ajax({
			//url: "http://192.168.1.233:8887/answer/save", //请求的url地址
			url: "http://" + serverIP + "/answer/start", //请求的url地址
			dataType: "json", //返回格式为json
			contentType: 'application/json',
			async: true, //请求是否异步，默认为异步，这也是ajax重要特性
			data: JSON.stringify(datas), //参数值
			type: "POST", //请求方式
			beforeSend: function () {
				//请求前的处理
			},
			success: function (res) {
				//请求成功时处理
				console.log(`res is ${JSON.stringify(res)}`)
			},
			complete: function () {
				//请求完成的处理
			},
			error: function () {
				//请求出错处理
			}
		});
	}

	function noteStop() {
		let datas = {code: userName}
		$.ajax({
			//url: "http://192.168.1.233:8887/answer/save", //请求的url地址
			url: "http://" + serverIP + "/answer/stop", //请求的url地址
			dataType: "json", //返回格式为json
			contentType: 'application/json',
			async: true, //请求是否异步，默认为异步，这也是ajax重要特性
			data: JSON.stringify(datas), //参数值
			type: "POST", //请求方式
			beforeSend: function () {
				//请求前的处理
			},
			success: function (res) {
				//请求成功时处理
				console.log(`res is ${JSON.stringify(res)}`)
				layer.open({
					title: " ",
					area: ['300px', '200px'],
					content: '<center>答题用时: ' + res.useTime + '</center>',
					btn: [],
					closeBtn: 0,
					shade: [0.8]
				});
			},
			complete: function () {
				//请求完成的处理
			},
			error: function () {
				//请求出错处理
			}
		});
	}

	// setTimeout(function () {
	//   layer.alert('...', {
	//     closeBtn: 0,
	//     skin: 'ml-confirm-no-button',
	//     title: '',
	//     move: false,
	//     area: ['600px']
	//   });
	// }, 5000)
</script>


</body>


</html>